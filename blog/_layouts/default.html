<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ page.title }}{% if page.title and site.title %} · {% endif %}{{ site.title }}</title>

  <!-- 你的全站样式（放在 personal-page/assets/...），Jekyll 会自动加上 baseurl -->
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>
<body>
  <!-- 动态导航栏占位 -->
  <div id="navbar-placeholder" data-src="/includes/navbar.html"></div>

  <main id="content">
    {{ content }}
  </main>

  <!-- 可选：页脚也能动态加载（放开下面两行并准备 /includes/footer.html 即可） -->
  <!-- <div id="footer-placeholder" data-src="/includes/footer.html"></div> -->

  <script>
    // 动态加载片段：把占位符替换成远程 HTML
    async function injectFragment(placeholderId) {
      const el = document.getElementById(placeholderId);
      if (!el) return;
      const src = el.dataset.src;               // 例如：/includes/navbar.html
      if (!src) return;

      try {
        const res = await fetch(src, { cache: 'no-store' });
        if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
        const html = await res.text();
        // 用加载到的 HTML 整体替换占位元素本身
        el.outerHTML = html;

        // 如果你的 navbar 里用了以 "/" 开头的绝对路径，并且本仓库是 GitHub Pages 的项目页（而非 user/org 根页），
        // 想要强制给这些链接自动加上 Jekyll 的 baseurl，可放开下面这段重写逻辑：
        /*
        const baseurl = "{{ site.baseurl | default: '' }}";
        if (baseurl && baseurl !== '/') {
          document.querySelectorAll('nav a[href^="/"]').forEach(a => {
            // 跳过外链和以 // 开头的协议相对链接
            if (/^\/\/|^https?:\/\//i.test(a.getAttribute('href'))) return;
            a.setAttribute('href', baseurl + a.getAttribute('href'));
          });
        }
        */
      } catch (err) {
        // 最简兜底导航（加载失败时）
        el.innerHTML = `
          <nav style="padding:12px;border-bottom:1px solid #eee">
            <a href="{{ '/' | relative_url }}">首页</a>
            &nbsp;|&nbsp;
            <a href="{{ '/my-blog/' | relative_url }}">博客</a>
          </nav>
        `;
      }
    }

    injectFragment('navbar-placeholder');
    // injectFragment('footer-placeholder'); // 如果需要动态加载页脚
  </script>

  <noscript>
    <nav style="padding:12px;border-bottom:1px solid #eee">
      <a href="{{ '/' | relative_url }}">首页</a>
      &nbsp;|&nbsp;
      <a href="{{ '/my-blog/' | relative_url }}">博客</a>
    </nav>
  </noscript>
</body>
</html>
