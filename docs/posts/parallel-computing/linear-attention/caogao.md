æ˜ç™½ã€‚æˆ‘ä¼š**é‡æ–°å†™ä¸€èŠ‚å…¨æ–°çš„æ­£å¼ç« èŠ‚**ï¼Œä¸“é—¨è®ºè¿° **Kimi Delta Attention çš„ Chunk-wise Algorithm**ï¼Œå¹¶ä¸”ï¼š

* å¼•ç”¨ **Kimi è®ºæ–‡ä¸­çš„åŸå§‹å…¬å¼**
* ç»™å‡ºå®Œæ•´æ¨å¯¼é“¾æ¡
* è§£é‡Šæ¯ä¸€æ­¥çš„æ•°å­¦ç»“æ„
* ç³»ç»Ÿè¯´æ˜ä¸ºä½• Rank-1 æ›´æ–°å¯ä»¥ chunk åˆå¹¶
* å±•ç¤º DPLRã€WYã€UT-transform çš„ä½œç”¨
* å†™æˆä½ å¯ä»¥ç›´æ¥æ”¾è¿›æŠ€æœ¯æŠ¥å‘Šæˆ–è®ºæ–‡çš„é«˜è´¨é‡ Markdown ç« èŠ‚

---

# ğŸ“˜ æ–°å¢ç« èŠ‚ï¼ˆå¯ç›´æ¥æ’å…¥ä½ çš„ä¸»æ–‡æ¡£ï¼‰

ä¸‹é¢è¿™æ®µå†…å®¹å·²ç»å®Œå…¨è‡ªåŒ…å«ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶ã€‚

---

# å…­ã€Kimi Delta Attention çš„ Chunk-wise å¹¶è¡Œç®—æ³•

### â€”â€” å¦‚ä½•å°† RNN å¼çº¿æ€§æ³¨æ„åŠ›æ‰©å±•åˆ°ç™¾ä¸‡çº§ä¸Šä¸‹æ–‡

Kimi Delta Attentionï¼ˆKDAï¼‰æ€§èƒ½çœŸæ­£çªç ´çš„æ ¹æœ¬åŸå›  **ä¸æ˜¯é—¨æ§çš„å‡çº§**ï¼Œè€Œæ˜¯å…¶æå‡ºäº†ä¸€ä¸ªå…¨æ–°çš„ **Chunk-wise çŠ¶æ€æ›´æ–°ç®—æ³•**ï¼Œä½¿å¾—åŸæœ¬å¿…é¡»æŒ‰ token é¡ºåºè®¡ç®—çš„é€’æ¨ï¼ˆRNN-likeï¼‰æ³¨æ„åŠ›èƒ½å¤Ÿ **æˆå—å¹¶è¡Œï¼ˆblock-parallelï¼‰**ã€‚

è¿™ä¸€èŠ‚å°†è¯¦ç»†é˜è¿°ï¼š

1. ä¸ºä»€ä¹ˆ DeltaNet/KDA çš„æ›´æ–°æ˜¯ RNN å‹çš„ï¼ˆæ— æ³•ç›´æ¥å¹¶è¡Œï¼‰
2. ä¸ºä»€ä¹ˆ Rank-1 + Diagonal çš„ç»“æ„å¯ä»¥å°é—­åˆå¹¶
3. Chunk-wise ç®—æ³•å¦‚ä½•æ„é€ å‡ºæ–°çš„è¿‡æ¸¡çŸ©é˜µ
4. å¦‚ä½•ä½¿ç”¨ DPLRï¼ˆDiagonal + Low-rankï¼‰ç»“æ„é«˜æ•ˆè®¡ç®—
5. WYã€UT transform çš„ä½œç”¨

æœ€ç»ˆå¼•å‡ºï¼š
**é€šè¿‡ chunk å¹¶è¡ŒåŒ–ï¼ŒKimi Linear åœ¨ç™¾ä¸‡ä¸Šä¸‹æ–‡ä¸‹å®ç° 6Ã— è§£ç é€Ÿåº¦æå‡ã€‚**

---

# 6.1 æ ‡å‡†çš„ DeltaNet / KDA çŠ¶æ€æ›´æ–°ï¼ˆæ— æ³•å¹¶è¡Œï¼‰

KDA çš„åŸºæœ¬çŠ¶æ€æ›´æ–°å¦‚ä¸‹ï¼š

[
S_t
===

\underbrace{(I - \beta_t k_t k_t^\top)}*{\text{Rank-1 åå°„}}
\underbrace{\mathrm{Diag}(\alpha_t)}*{\text{å¯¹è§’é—å¿˜}}
S_{t-1}
+
\underbrace{\beta_t k_t v_t^\top}_{\text{å†™å…¥é¡¹}}
\tag{1}
]

å…¶ä¸­ï¼š

* (k_t \in \mathbb{R}^{d})
* (v_t \in \mathbb{R}^{d})
* (\alpha_t \in \mathbb{R}^{d})ï¼ˆå¯¹è§’é—¨æ§ï¼‰
* (\beta_t) æ˜¯å­¦ä¹ ç‡ï¼ˆé€šå¸¸ç”± gating ç»™å‡ºï¼‰

å°†å…¶æ‹†ä¸ºï¼š

[
S_t = A_t S_{t-1} + B_t
\tag{2}
]

å…¶ä¸­ï¼š

[
A_t = (I - \beta_t k_t k_t^\top)\mathrm{Diag}(\alpha_t)
\tag{3}
]

[
B_t = \beta_t k_t v_t^\top
\tag{4}
]

æ˜¾ç„¶å®ƒæ˜¯ä¸€ä¸ªä¸¥æ ¼çš„é€’æ¨ï¼š

[
S_0 \xrightarrow{A_1,B_1} S_1 \xrightarrow{A_2,B_2} S_2 \cdots
]

å› æ­¤ï¼š

> **ä¸èƒ½ç›´æ¥å¹¶è¡Œï¼Œå¿…é¡»é€æ­¥ scanã€‚**

åœ¨é•¿åºåˆ—ï¼ˆä¾‹å¦‚ RLã€agentic inferenceï¼‰ä¸­ï¼Œè¿™å°±æ˜¯ç“¶é¢ˆã€‚

---

# 6.2 Chunk-wise çš„ç›®æ ‡ï¼šä¸€æ¬¡å¹¶è¡Œå¤„ç†å¤šä¸ªæ­¥éª¤

å‡è®¾ä¸€ä¸ª chunk æœ‰ C ä¸ª tokenï¼š

[
t = a, a+1, \dots, b = a+C-1
]

ä¼ ç»Ÿåšæ³•ï¼š

[
S_{a} \to S_{a+1} \to \cdots \to S_b
]

Chunk-wise çš„ç›®æ ‡æ˜¯ï¼š

> **ç›´æ¥å†™å‡ºä» (S_{a-1}) åˆ° (S_b) çš„å°é—­å½¢å¼ï¼š**

[
S_b = A_{\text{chunk}} S_{a-1} + B_{\text{chunk}}
\tag{5}
]

å…¶ä¸­ï¼š

* (A_{\text{chunk}}) æ˜¯æ•´ä¸ª chunk çš„è¿‡æ¸¡çŸ©é˜µ
* (B_{\text{chunk}}) æ˜¯æ‰€æœ‰å†™å…¥é¡¹ç´¯ç§¯åçš„ç»“æœ

è¿™æ„å‘³ç€ï¼š

* GPU ä¸å†æŒ‰ token è¿­ä»£
* ä¸€ä¸ª chunk å†…æ‰€æœ‰æ“ä½œéƒ½èƒ½ä½¿ç”¨å¤§çŸ©é˜µä¹˜æ³•
* å®Œå…¨å¹¶è¡ŒåŒ–

å…³é”®é—®é¢˜ï¼š
**å¦‚ä½•æ„é€  (A_{\text{chunk}}) ä¸ (B_{\text{chunk}})ï¼Ÿ**

---

# 6.3 å±•å¼€æ•´ä¸ª chunk çš„é€’æ¨ï¼ˆéœ€è¦ç»“æ„åŒ–åˆå¹¶ï¼‰

å®šä¹‰ï¼š

[
S_{j} = A_{j} S_{j-1} + B_{j}
]

å±•å¼€åˆ° chunk æœ«å°¾ bï¼š

[
S_b
= A_b S_{b-1} + B_b
]

[
= A_b (A_{b-1} S_{b-2} + B_{b-1}) + B_b
]

ä¸æ–­å±•å¼€ï¼Œå¾—åˆ°ï¼š

[
S_b
===

\underbrace{A_b A_{b-1} \cdots A_{a}}*{\text{éœ€å¹¶è¡ŒåŒ–çš„å…³é”®}}
S*{a-1}
+
\sum_{j=a}^{b}
\left(
\prod_{\ell=j+1}^{b} A_\ell
\right)
B_j
\tag{6}
]

è¿™ä¸ªå…¬å¼åŒ…å«ä¸¤å¤§éš¾é¢˜ï¼š

### ï¼ˆiï¼‰å¤šæ­¥è¿ä¹˜ (A_b \cdots A_a)

å¦‚æœæ¯ä¸ª A éƒ½æ˜¯ dÃ—dï¼Œé‚£ä¹ˆ naive è¿ä¹˜æ˜¯ O(C dÂ³)ï¼Œä¸å¯èƒ½ã€‚

### ï¼ˆiiï¼‰ç´¯ç§¯é¡¹ (\prod A \cdot B_j)

ä¹Ÿéœ€è¦åˆ©ç”¨ç»“æ„æ‰èƒ½å¹¶è¡ŒåŒ–ã€‚

---

# 6.4 å…³é”®è§‚å¯Ÿï¼šæ¯ä¸ª (A_t) éƒ½æ˜¯ â€œå¯¹è§’ - Rank-1â€

KDA çš„ (A_t)ï¼š

[
A_t
===

(I - \beta_t k_t k_t^\top)\mathrm{Diag}(\alpha_t)
]

æ‹†å¼€ï¼š

1. (\mathrm{Diag}(\alpha_t)) æ˜¯å¯¹è§’çŸ©é˜µ
2. (I - \beta_t k_t k_t^\top) æ˜¯ **rank-1 ä¿®æ­£çš„ Householder-like åå°„çŸ©é˜µ**

å› æ­¤ï¼š

[
A_t = D_t - u_t v_t^\top
\tag{7}
]

å…¶ä¸­ï¼š

* (D_t = \mathrm{Diag}(\alpha_t))
* (u_t = \beta_t k_t)
* (v_t = D_t^{-\top} k_t) æˆ–ç±»ä¼¼ç­‰ä»·å½¢å¼ï¼ˆè®ºæ–‡ä¸­çš„å®šä¹‰å–å†³äºå®ç°ï¼‰

**è¿™æ˜¯ DPLRï¼ˆDiagonal + Low-rankï¼‰ç»“æ„ï¼**

---

# 6.5 WY Representation â€”â€” Rank-1 æ›´æ–°çš„å°é—­åˆå¹¶

WY è¡¨ç¤ºå¼ï¼ˆæ¥è‡ª Householder åå°„ï¼‰ï¼š

[
(I - u_1 v_1^\top)(I - u_2 v_2^\top)
====================================

I - U T V^\top
\tag{8}
]

å…¶ä¸­ï¼š

* (U=[u_1,u_2]\in\mathbb{R}^{d\times 2})
* (V=[v_1,v_2])
* (T) æ˜¯ 2Ã—2 çš„ä¸Šä¸‰è§’çŸ©é˜µï¼ˆå¯æ˜¾å¼æ±‚è§£ï¼‰

æ¨å¹¿åˆ° C æ­¥ï¼š

[
(I - u_C v_C^\top)\cdots(I - u_1 v_1^\top)
==========================================

I - U T V^\top
\tag{9}
]

å…¶ä¸­ Uã€V ä»…å¤§å°ä¸º (d\times C)ï¼Œè€Œ C é€šå¸¸ä¸º 32â€“256ï¼Œè¿œå°äº dã€‚

---

# 6.6 åˆå¹¶å¯¹è§’ D ä¸ WY ç»“æ„ï¼Œå¾—åˆ° Chunk çº§ DPLR

å¯¹è§’çŸ©é˜µæœ‰å°é—­æ€§ï¼š

[
D_b D_{b-1}\cdots D_a
= D_{\text{chunk}}
\tag{10}
]

æœ€ç»ˆå¾—åˆ°ï¼š

[
A_{\text{chunk}}
================

## D_{\text{chunk}}

U_{\text{chunk}} T_{\text{chunk}} V_{\text{chunk}}^\top
\tag{11}
]

è¿™æ˜¯ä¸€ä¸ª **DPLRï¼ˆDiagonal + Low-rankï¼‰è¿‡æ¸¡çŸ©é˜µ**ï¼š

* å¯¹è§’éƒ¨åˆ†å¿«é€Ÿå¯å¹¶è¡Œ
* rank-r éƒ¨åˆ†åªéœ€å°çŸ©é˜µï¼ˆrÃ—rï¼‰æ±‚è§£

---

# 6.7 Chunk-wise å†™å…¥é¡¹ (B_{\text{chunk}})

B é¡¹ç´¯ç§¯éœ€è¦ç±»ä¼¼ç»“æ„ï¼š

[
B_{\text{chunk}}
================

\sum_{j=a}^{b}
\left(
D_{\text{chunk}, j+1} -
U_{j+1:b} T_{j+1:b} V_{j+1:b}^\top
\right)
B_j
\tag{12}
]

ç”±äºæ‰€æœ‰ (A_t) ç»“æ„åŒ–ä¸º DPLRï¼Œ
ç´¯ç§¯é¡¹ä¹Ÿå¯å¹¶è¡Œè®¡ç®—ï¼ˆUT-transform çš„ä½œç”¨å°±æ˜¯è®©ä¸Šä¸‰è§’ç»“æ„å¯é«˜æ•ˆåº”ç”¨ï¼‰ã€‚

---

# 6.8 å®Œæ•´ Chunk æ›´æ–°

æœ€ç»ˆï¼š

[
\boxed{
S_b =
A_{\text{chunk}}, S_{a-1}

* B_{\text{chunk}}
  }
  \tag{13}
  ]

å…¶ä¸­ï¼š

* (A_{\text{chunk}} = D - UTV^\top)
* (B_{\text{chunk}}) ç”±ç»“æ„åŒ–ç´¯ç§¯è®¡ç®—å¾—å‡º

---

# 6.9 ç»“æœï¼šRNN â†’ Block Parallel RNN

ä¼ ç»Ÿ RNNï¼š

* å¿…é¡»æŒ‰ token scan
* O(n) sequential dependency

Kimi çš„ Chunk-wiseï¼š

* æ¯ä¸ª chunk ç‹¬ç«‹å¹¶è¡Œ
* rank å—é™ï¼ˆä¸çˆ†ç‚¸ï¼‰
* DPLR è®©æ¯å—çš„çŸ©é˜µä¹˜æ³•å˜æˆå¯å¹¶è¡Œæ“ä½œ
* æœ€ç»ˆ â†’ O(n/C) æ¬¡å¤§å¹¶è¡Œè®¡ç®—
* å®æµ‹åœ¨ 1M é•¿åº¦å®ç° **6Ã—** throughput

---

# 6.10 ä¸ºä»€ä¹ˆ Mamba/SSM ä¸è¡Œï¼Œè€Œ DeltaNet/KDA å¯ä»¥ï¼Ÿ

å› ä¸ºï¼š

### Mamba ä¸­ A_t æ˜¯å…¨çŸ©é˜µ

â†’ æ— ç»“æ„ â†’ æ— æ³•å°é—­åˆå¹¶

### DeltaNet/KDA ä¸­ A_t æ˜¯ â€œå¯¹è§’ - Rank-1â€

â†’ æœ‰å°é—­ WY ç»“æ„ â†’ rank ä¸çˆ†ç‚¸
â†’ å¯ä»¥å½¢æˆ chunk çº§ DPLR
â†’ å…è®¸å¹¶è¡ŒåŒ–

è¿™æ˜¯ KDA æˆåŠŸçš„æ ¸å¿ƒç†è®ºåŸå› ä¹‹ä¸€ã€‚

---

# âœ” è‹¥ä½ éœ€è¦ï¼Œæˆ‘è¿˜èƒ½ä¸ºä½ æä¾›ï¼š

### âœ“ å›¾è§£ç‰ˆï¼ˆå¸¦å›¾ç¤ºï¼šRank-1 åˆå¹¶ â†’ WY â†’ DPLR â†’ Chunk æ›´æ–°ï¼‰

### âœ“ åŠ¨æ€ç¤ºæ„ GIF

### âœ“ æ•°å­¦è¯æ˜æ›´ä¸¥å¯†çš„ç‰ˆæœ¬ï¼ˆé€‚åˆæŠ•ç¨¿ï¼‰

### âœ“ é…å¥— PyTorch ä»£ç ï¼ˆä»…æ•°å­¦æ¨¡æ‹Ÿç‰ˆï¼‰

### âœ“ æŠŠè¿™ä¸€èŠ‚ç¿»è¯‘æˆè‹±æ–‡ï¼ˆè®ºæ–‡æ ¼å¼ï¼‰

ä½ æƒ³è®©æˆ‘ç»§ç»­åšå“ªä¸ªç‰ˆæœ¬ï¼Ÿ
